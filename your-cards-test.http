### Variables Globales
@host = http://localhost:8080
@contentType = application/json
@auth_token = eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0dXNlciIsImlhdCI6MTc2OTQ1NTQyMiwiZXhwIjoxNzY5NTQxODIyfQ.JiNts3DvuTKtARZKrf4deIsnSVj1m_HNvxEUk6EwoOc

### PRE-REQUISITO: Crear una colección para usar en este test
POST {{host}}/collections/create
Content-Type: {{contentType}}
Authorization: Bearer {{auth_token}}

{
  "name": "Carpeta de Intercambio"
}

> {%
    client.global.set("testCollectionId", response.body.id);
%}

### 1. Añadir una carta a la colección
# Asumimos que CardRequest necesita cardId (o nombre), collectionId y condition
POST {{host}}/your-cards/add
Content-Type: {{contentType}}
Authorization: Bearer {{auth_token}}

{
  "cardName": "Black Lotus",
  "collectionId": {{testCollectionId}},
  "condition": "NEAR_MINT",
  "isFoil": false
}

> {%
    client.test("Carta añadida a colección - Estado 200", function() {
        client.assert(response.status === 200, "Error al añadir carta: " + (response.body.error || ""));
    });
    // Guardamos el ID de la relación (CardOwned)
    client.global.set("ownedCardId", response.body.id);
%}

### 2. Listar cartas de una colección específica
GET {{host}}/your-cards/collection/{{testCollectionId}}
Accept: {{contentType}}
Authorization: Bearer {{auth_token}}

> {%
    client.test("Listar cartas - Estado 200", function() {
        client.assert(response.status === 200, "Error al listar cartas");
    });
    client.test("La lista contiene elementos", function() {
        client.assert(response.body.length > 0, "La colección debería tener al menos una carta");
    });
%}

### 3. Actualizar el estado de la carta (ej. cambiar condición)
PUT {{host}}/your-cards/update/{{ownedCardId}}
Content-Type: {{contentType}}
Authorization: Bearer {{auth_token}}

{
  "condition": "PLAYED",
  "isFoil": true
}

> {%
    client.test("Carta actualizada - Estado 200", function() {
        client.assert(response.status === 200, "Error al actualizar carta");
    });
    client.test("Condición cambiada", function() {
        // Verificamos si devuelve el objeto actualizado
        if (response.body.condition) {
            client.assert(response.body.condition === "PLAYED" || response.body.condition.displayName === "Played", "La condición no cambió");
        }
    });
%}

### 4. Eliminar la carta de la colección
DELETE {{host}}/your-cards/delete/{{ownedCardId}}
Authorization: Bearer {{auth_token}}

> {%
    client.test("Carta eliminada - Estado 200", function() {
        client.assert(response.status === 200, "Error al eliminar carta");
    });
%}

### LIMPIEZA: Eliminar la colección de prueba
DELETE {{host}}/collections/delete/{{testCollectionId}}
Authorization: Bearer {{auth_token}}

> {%
    client.test("Limpieza completada", function() {
        client.assert(response.status === 200, "Error al limpiar colección de prueba");
    });
%}